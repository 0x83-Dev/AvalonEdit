<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><title>Coordinate Systems</title><link rel="stylesheet" type="text/css" href="../styles/presentation.css" /><script type="text/javascript" src="../scripts/script_prototype.js"> </script><script type="text/javascript" src="../scripts/EventUtilities.js"> </script><script type="text/javascript" src="../scripts/StyleUtilities.js"> </script><script type="text/javascript" src="../scripts/SplitScreen.js"> </script><script type="text/javascript" src="../scripts/ElementCollection.js"> </script><script type="text/javascript" src="../scripts/MemberFilter.js"> </script><script type="text/javascript" src="../scripts/CollapsibleSection.js"> </script><script type="text/javascript" src="../scripts/LanguageFilter.js"> </script><script type="text/javascript" src="../scripts/CookieDataStore.js"> </script></head><body><img id="copyImage" style="display:none; height:0; width:0;" src="../icons/copycode.gif" alt="Copy image" title="Copy image" /><img id="copyHoverImage" style="display:none; height:0; width:0;" src="../icons/copycodeHighlight.gif" alt="CopyHover image" title="CopyHover image" /><div id="control"><span class="productTitle">AvalonEdit</span><br /><span class="topicTitle">Coordinate Systems</span><br /><div id="toolbar"><span id="languageFilter"><select id="languageSelector" onchange="var names = this.value.split(' '); toggleVisibleLanguage(names[1]); switchLanguage(names, this.value);"><option value="CSharp cs">C#</option><option value="VisualBasic vb">Visual Basic</option><option value="ManagedCPlusPlus cpp">Visual C++</option></select></span></div></div><div id="main"><span style="color: DarkGray"></span><div class="introduction"><p>The text editor makes use of several different coordinate systems.
		Here's an explanation of them.</p></div><div class="section"><div class="sectionTitle" onclick="toggleSection(this.parentNode)"><img src="../icons/collapse_all.gif" /> Offset</div><div class="sectionContent"><div class="subsection"><p>In AvalonEdit, an index into the document is called an <span class="term">offset</span>.</p><p>
			Offsets usually represent the position between two characters.
			The first offset at the start of the document is 0;
			the offset after the first char in the document is 1.
			The last valid offset is <span class="code">document.TextLength</span>,
			representing the end of the document.
			This is exactly the same as the <span class="code">index</span> parameter
			used by methods in the .NET String or StringBuilder classes.
        </p></div></div></div><div class="section"><div class="sectionTitle" onclick="toggleSection(this.parentNode)"><img src="../icons/collapse_all.gif" /> TextLocation</div><div class="sectionContent"><div class="subsection"><p>The
        <span sdata="cer" target="T:ICSharpCode.AvalonEdit.Document.TextLocation"><a href="2af6466e-1916-c9d6-2473-39b0acf398cf.htm">ICSharpCode.AvalonEdit.Document<span class="languageSpecificText"><span class="cs">.</span><span class="vb">.</span><span class="cpp">::</span><span class="nu">.</span><span class="fs">.</span></span>TextLocation</a></span>
        struct represents a Line/Column pair. Line and column are counted from 1.</p><p>The document provides the methods
				<span sdata="cer" target="M:ICSharpCode.AvalonEdit.Document.TextDocument.GetLocation(System.Int32)"><a href="736938ff-8c49-2592-d505-58e282f77ff7.htm">TextDocument<span class="languageSpecificText"><span class="cs">.</span><span class="vb">.</span><span class="cpp">::</span><span class="nu">.</span><span class="fs">.</span></span>GetLocation(Int32)</a></span>
				and
				<span sdata="cer" target="M:ICSharpCode.AvalonEdit.Document.TextDocument.GetOffset(ICSharpCode.AvalonEdit.Document.TextLocation)"><a href="c323ff45-e3d0-4bbc-73b8-890c964782ba.htm">TextDocument<span class="languageSpecificText"><span class="cs">.</span><span class="vb">.</span><span class="cpp">::</span><span class="nu">.</span><span class="fs">.</span></span>GetOffset(TextLocation)</a></span>
			to convert between offsets and <span class="code">TextLocation</span>s.</p></div></div></div><div class="section"><div class="sectionTitle" onclick="toggleSection(this.parentNode)"><img src="../icons/collapse_all.gif" /> TextAnchor</div><div class="sectionContent"><div class="subsection"><p>If you are working with the text editor, you will likely run into the problem
      	that you need to store an offset, but want it to adjust automatically whenever
      	text is inserted prior to that offset. </p><p>Sure, you could listen to the TextDocument.Changed event and call
      	GetNewOffset on the DocumentChangeEventArgs to translate the offset,
      	but that gets tedious; especially when your object is short-lived and you
      	have to deal with deregistering the event handler at the correct point of time.</p><p>A text anchor object stores an Offset, but automatically
			updates the offset when text is inserted/removed before the offset.
		</p><p>
			A much simpler solution is to use the
			<span sdata="cer" target="T:ICSharpCode.AvalonEdit.Document.TextAnchor"><a href="a1493e4b-2fc2-e16a-1d4c-a6af0f8729bd.htm">ICSharpCode.AvalonEdit.Document<span class="languageSpecificText"><span class="cs">.</span><span class="vb">.</span><span class="cpp">::</span><span class="nu">.</span><span class="fs">.</span></span>TextAnchor</a></span>
			class.
			Please take a look at the documentation for that class for more details.
		</p></div></div></div><div class="section"><div class="sectionTitle" onclick="toggleSection(this.parentNode)"><img src="../icons/collapse_all.gif" /> RelativeTextOffset</div><div class="sectionContent"><div class="subsection"><p>An offset in the document, but relative to the start offset of a <span sdata="cer" target="T:ICSharpCode.AvalonEdit.Rendering.VisualLine"><a href="2945b06d-8cd4-bfeb-eabf-aa0fe2830356.htm">VisualLine</a></span>.</p><p>Relative text offsets are used to store document offsets in visual lines.</p><p>You can convert between relative text offsets and document offsets
			by adding/subtracting
			<span sdata="cer" target="P:ICSharpCode.AvalonEdit.Rendering.VisualLine.FirstDocumentLine"><a href="8cb9a84a-1804-823e-9b24-4310b80bcd68.htm">VisualLine<span class="languageSpecificText"><span class="cs">.</span><span class="vb">.</span><span class="cpp">::</span><span class="nu">.</span><span class="fs">.</span></span>FirstDocumentLine</a></span>.<span sdata="cer" target="P:ICSharpCode.AvalonEdit.Document.DocumentLine.Offset"><a href="34a4d3c6-a90e-609c-6c47-aeb9c08e8a3e.htm">Offset</a></span>.
			</p></div></div></div><div class="section"><div class="sectionTitle" onclick="toggleSection(this.parentNode)"><img src="../icons/collapse_all.gif" /> VisualColumn</div><div class="sectionContent"><div class="subsection"><p>An integer value that specifies a position inside a VisualLine.</p><p>
			Not only text has a length in the visual line, but also other VisualLineElements.
			VisualColumn is counting from 0 for each visual line.
			</p><p>For example, tab markers take 2 visual columns (the marker and the tab space),
			newline markers take 1 visual column; folding markers take just 1 visual column
			even though they are longer in the document text.</p><p>Use the
			<span sdata="cer" target="M:ICSharpCode.AvalonEdit.Rendering.VisualLine.GetVisualColumn(System.Int32)"><a href="360bc8c8-d2b7-f286-9ad5-5049ee6908c7.htm">VisualLine<span class="languageSpecificText"><span class="cs">.</span><span class="vb">.</span><span class="cpp">::</span><span class="nu">.</span><span class="fs">.</span></span>GetVisualColumn(Int32)</a></span>
			and 
			<span sdata="cer" target="M:ICSharpCode.AvalonEdit.Rendering.VisualLine.GetRelativeOffset(System.Int32)"><a href="859f95ca-4250-ea46-873a-dec5998c1ea8.htm">VisualLine<span class="languageSpecificText"><span class="cs">.</span><span class="vb">.</span><span class="cpp">::</span><span class="nu">.</span><span class="fs">.</span></span>GetRelativeOffset(Int32)</a></span>
			methods to convert between
			visual columns and relative text offsets.</p><div class="alert"><table><tr><th><img src="../icons/alert_note.gif" title="Note" /> <b>Note:</b></th></tr><tr><td><p>Do not confuse VisualColumn with text columns.
				VisualColumn starts at 0, text column at 1. Text may have different length
				in the two coordinate systems (e.g. tab markers, foldings).</p></td></tr></table></div></div></div></div><div class="section"><div class="sectionTitle" onclick="toggleSection(this.parentNode)"><img src="../icons/collapse_all.gif" /> TextViewPosition</div><div class="sectionContent"><div class="subsection"><p>A Line,Column,VisualColumn triple.</p><p>The <span sdata="cer" target="T:ICSharpCode.AvalonEdit.TextViewPosition"><a href="ba7722cc-90f5-771d-487f-981378a13d41.htm">ICSharpCode.AvalonEdit<span class="languageSpecificText"><span class="cs">.</span><span class="vb">.</span><span class="cpp">::</span><span class="nu">.</span><span class="fs">.</span></span>TextViewPosition</a></span>
        	struct can be implicitly converted
			to <span sdata="cer" target="T:ICSharpCode.AvalonEdit.Document.TextLocation"><a href="2af6466e-1916-c9d6-2473-39b0acf398cf.htm">TextLocation</a></span>,
			but has the additional VisualColumn information
			that is necessary to accurately hold the caret position when
			VisualLineElements with DocumentLength 0 are in use.</p></div></div></div><div class="section"><div class="sectionTitle" onclick="toggleSection(this.parentNode)"><img src="../icons/collapse_all.gif" /> VisualTop</div><div class="sectionContent"><div class="subsection"><p>A double value that specifies the distance from the top of
			the document to the top of a line measured in device-independent pixels.</p><p>VisualTop is equivalent to the Y component of a VisualPosition.</p></div></div></div><div class="section"><div class="sectionTitle" onclick="toggleSection(this.parentNode)"><img src="../icons/collapse_all.gif" /> VisualPosition</div><div class="sectionContent"><div class="subsection"><p>A Point value (double X,Y) that specifies the position of an
			element from the top left document corner measured in device-independent pixels.</p><p>To convert a VisualPosition to or from a (mouse) position inside
			the TextView, simply subtract or add
			<span sdata="cer" target="P:ICSharpCode.AvalonEdit.Rendering.TextView.ScrollOffset"><a href="f1fdb7e1-9ac8-1821-bb6f-238299e29cbd.htm">TextView<span class="languageSpecificText"><span class="cs">.</span><span class="vb">.</span><span class="cpp">::</span><span class="nu">.</span><span class="fs">.</span></span>ScrollOffset</a></span>
			to it.
			</p></div></div></div><div id="footer"><p />Copyright 2008-2014, Daniel Grunwald</div></div></body></html>