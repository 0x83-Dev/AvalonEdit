<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><title>Folding</title><link rel="stylesheet" type="text/css" href="../styles/presentation.css" /><script type="text/javascript" src="../scripts/script_prototype.js"> </script><script type="text/javascript" src="../scripts/EventUtilities.js"> </script><script type="text/javascript" src="../scripts/StyleUtilities.js"> </script><script type="text/javascript" src="../scripts/SplitScreen.js"> </script><script type="text/javascript" src="../scripts/ElementCollection.js"> </script><script type="text/javascript" src="../scripts/MemberFilter.js"> </script><script type="text/javascript" src="../scripts/CollapsibleSection.js"> </script><script type="text/javascript" src="../scripts/LanguageFilter.js"> </script><script type="text/javascript" src="../scripts/CookieDataStore.js"> </script><link type="text/css" rel="stylesheet" href="../styles/highlight.css" /><script type="text/javascript" src="../scripts/highlight.js"> </script></head><body><img id="copyImage" style="display:none; height:0; width:0;" src="../icons/copycode.gif" alt="Copy image" title="Copy image" /><img id="copyHoverImage" style="display:none; height:0; width:0;" src="../icons/copycodeHighlight.gif" alt="CopyHover image" title="CopyHover image" /><div id="control"><span class="productTitle">AvalonEdit</span><br /><span class="topicTitle">Folding</span><br /><div id="toolbar"><span id="languageFilter"><select id="languageSelector" onchange="var names = this.value.split(' '); toggleVisibleLanguage(names[1]); switchLanguage(names, this.value);"><option value="CSharp cs">C#</option><option value="VisualBasic vb">Visual Basic</option><option value="ManagedCPlusPlus cpp">Visual C++</option></select></span></div></div><div id="main"><span style="color: DarkGray"></span><div class="section"><div class="sectionTitle" onclick="toggleSection(this.parentNode)"><img src="../icons/collapse_all.gif" /> How to use Folding in your application</div><div class="sectionContent"><div class="subsection"><p>
        Folding (code collapsing) is implemented as an extension to the editor.
        It could have been implemented in a separate assembly without having to
        modify the AvalonEdit code. 
        A <span sdata="cer" target="T:ICSharpCode.AvalonEdit.Rendering.VisualLineElementGenerator"><a href="d2575fdb-3b24-c111-2ccf-31ba8527e8df.htm">VisualLineElementGenerator</a></span>
        takes care of the collapsed sections in the text document; and a custom
        margin draws the plus and minus buttons.
		</p><p>You could use the relevant classes separately;
		but, to make it a bit easier to use, the static
		<span sdata="cer" target="M:ICSharpCode.AvalonEdit.Folding.FoldingManager.Install(ICSharpCode.AvalonEdit.Editing.TextArea)"><a href="36ca8e5b-30f6-7a22-fdbb-4d95f83240b4.htm">FoldingManager<span class="languageSpecificText"><span class="cs">.</span><span class="vb">.</span><span class="cpp">::</span><span class="nu">.</span><span class="fs">.</span></span>Install(TextArea)</a></span>
		method will create and register the necessary parts automatically.</p><p>All that's left for you is to regularly call
		<span sdata="cer" target="M:ICSharpCode.AvalonEdit.Folding.FoldingManager.UpdateFoldings(System.Collections.Generic.IEnumerable{ICSharpCode.AvalonEdit.Folding.NewFolding},System.Int32)"><a href="22dd3eb2-85d6-4d45-242e-daf17a9bf043.htm">FoldingManager<span class="languageSpecificText"><span class="cs">.</span><span class="vb">.</span><span class="cpp">::</span><span class="nu">.</span><span class="fs">.</span></span>UpdateFoldings(IEnumerable<span class="languageSpecificText"><span class="cs">&lt;</span><span class="vb">(Of </span><span class="cpp">&lt;</span><span class="fs">&lt;'</span><span class="nu">(</span></span>NewFolding<span class="languageSpecificText"><span class="cs">&gt;</span><span class="vb">)</span><span class="cpp">&gt;</span><span class="fs">&gt;</span><span class="nu">)</span></span>, Int32)</a></span>
		with the list of foldings you want to provide.
		You could calculate that list yourself, or you could use a built-in
		folding strategy to do it for you.</p><p>Here is the full code required to enable folding: 
<div class="code"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C# </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this, event)" onmouseover="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" alt="Copy image" title="Copy image" src="../icons/copycode.gif" />Copy</span></th></tr><tr><td colspan="2"><pre xml:space="preserve">foldingManager = FoldingManager.Install(textEditor.TextArea);
foldingStrategy = <span class="highlight-keyword">new</span> XmlFoldingStrategy();
foldingStrategy.UpdateFoldings(foldingManager, textEditor.Document);</pre></td></tr></table></div>
		If you want the folding markers to update when the text is changed,
		you have to repeat the <span class="code">foldingStrategy.UpdateFoldings</span> call regularly.
		</p></div></div></div><div class="section"><div class="sectionTitle" onclick="toggleSection(this.parentNode)"><img src="../icons/collapse_all.gif" /> How the FoldingManager works</div><div class="sectionContent"><div class="subsection"><p>
	The FoldingManager maintains a list of foldings. The FoldMargin displays those foldings and provides
	the UI for collapsing/expanding.</p><p>
	Folded foldings cause the FoldingElementGenerator to produce a line element that spans the whole folded
	text section, causing the text generation for the visual line that contains the folding start to
	continue after the folding end in another line.</p><p>
	To ensure scrolling works correctly in the presence of foldings, lines inside folded regions must not
	be used as start lines for the visual line generation. This is done by setting the line height of all
	such lines to 0. To efficiently set the height on a large number of lines and support reverting to the
	old height when the folding is uncollapsed, a CollapsedLineSection is used.
			</p></div></div></div><div id="seeAlsoSection" class="section"><div class="sectionTitle">See Also</div><div class="sectionContent"><span sdata="cer" target="T:ICSharpCode.AvalonEdit.Folding.FoldingManager"><a href="345c672e-d3fd-5f5c-3d41-3582da2464cc.htm">FoldingManager</a></span><br /></div></div><div id="footer"><p />Copyright 2008-2014, Daniel Grunwald</div></div></body></html>